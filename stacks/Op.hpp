// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Pragma.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#pragma once

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Imports.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include <fx/Types.hpp>
#include <fx/Utilities.hpp>
#include <iostream>

// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Stacks - Neural Networks Toolkit.
// ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
namespace sx
{
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Expand namespaces.
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	using namespace fx;
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Transformation function options.
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	enum class Func
	{
		SIGMOID,
		TANH,
		RELU,
		PRELU
	};

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// Stack operation interface.
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	class Op
	{
		// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		// Members.
		// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		protected:
		Op* Back;
		Op* Front;
		const r32* Input;
		bool IsLocked;
		public:

		// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		// Functions.
		// ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
		Op ( void ) : Front(nullptr), Back(nullptr), Input(nullptr), IsLocked(false) {}
		virtual ~Op ( void ) {}

		virtual auto id ( void ) const -> u64 { return 0; }
		virtual auto shpin ( void ) const -> utl::Shape { return utl::Shape(0); }
		virtual auto shpout ( void ) const -> utl::Shape { return utl::Shape(0); }
		inline auto input ( void ) const -> const r32* { return this->Input; }
		virtual auto output ( void ) -> r32* { return nullptr; }
		virtual auto gradient ( void ) const -> const r32* { return nullptr; }
		virtual auto back ( void ) -> Op* { return this->Back; }
		virtual auto front ( void ) -> Op* { return this->Front; }
		virtual auto setBack ( Op* _Back ) -> void { this->Back = _Back; if(_Back) { this->Input = _Back->output(); _Back->setFront(this); } }
		virtual auto setFront ( Op* _Front ) -> void { this->Front = _Front; }

		virtual auto lock ( void ) -> void { this->IsLocked = true; }
		virtual auto unlock ( void ) -> void { this->IsLocked = false; }

		virtual auto execute ( const r32* _Input ) -> r32* { return nullptr; }
		virtual auto reset ( void ) -> void { return; }
		virtual auto fit ( const r32* _Target ) -> void { return; }
		virtual auto apply ( const r32 _Rate = 0.01f ) -> void { return; }
		virtual auto store ( std::ostream& _Stream ) const -> void { return; }
		virtual auto load ( std::istream& _Stream ) -> void { return; }
	};
}
